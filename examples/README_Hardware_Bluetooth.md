# ç¡¬ä»¶è“ç‰™è¿æ¥æ¨¡å—ä½¿ç”¨è¯´æ˜

## æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªåŸºäºä½ çš„ç¡¬ä»¶ä»£ç (`hardware.c`)å’Œç°æœ‰è“ç‰™ä»£ç (`bluetooth2.py`)å¼€å‘çš„è“ç‰™è¿æ¥æ¨¡å—ï¼Œç±»ä¼¼HCè“ç‰™åŠ©æ‰‹çš„åŠŸèƒ½ï¼Œä¸“é—¨ç”¨äºæ¥æ”¶å°è½¦æ¿€å…‰é›·è¾¾å‘é€çš„æ•°æ®ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ”— è“ç‰™è¿æ¥ç®¡ç†
- **è‡ªåŠ¨è¿æ¥**: æ”¯æŒè‡ªåŠ¨æ£€æµ‹å’Œè¿æ¥è“ç‰™è®¾å¤‡
- **è¿æ¥çŠ¶æ€ç›‘æ§**: å®æ—¶ç›‘æ§è¿æ¥çŠ¶æ€å’Œæ•°æ®æµé‡
- **è‡ªåŠ¨é‡è¿**: è¿æ¥æ–­å¼€æ—¶è‡ªåŠ¨å°è¯•é‡è¿
- **é”™è¯¯å¤„ç†**: å®Œå–„çš„å¼‚å¸¸å¤„ç†å’Œé”™è¯¯æ¢å¤æœºåˆ¶

### ğŸ“¡ æ•°æ®è§£æ
- **æ¿€å…‰é›·è¾¾æ•°æ®**: è§£æè§’åº¦ã€è·ç¦»ã€è´¨é‡ä¿¡æ¯
- **IMUæ•°æ®**: è§£æä¸‰è½´è§’åº¦(roll, pitch, yaw)
- **ç”µæœºæ•°æ®**: è§£æç”µæœºè½¬é€Ÿå’ŒçŠ¶æ€
- **å®æ—¶å¤„ç†**: å¤šçº¿ç¨‹æ•°æ®è§£æï¼Œç¡®ä¿å®æ—¶æ€§

### ğŸ® ç”µæœºæ§åˆ¶
- **é”®ç›˜æ§åˆ¶**: æ”¯æŒé”®ç›˜å®æ—¶æ§åˆ¶å°è½¦
- **å‘½ä»¤å‘é€**: å‘é€0-5æ•°å­—å‘½ä»¤æ§åˆ¶ç”µæœº
- **çŠ¶æ€åé¦ˆ**: å®æ—¶æ˜¾ç¤ºç”µæœºçŠ¶æ€å’Œè½¬é€Ÿ

### ğŸ“Š æ•°æ®å¯è§†åŒ–
- **æåæ ‡é›·è¾¾å›¾**: å®æ—¶æ˜¾ç¤ºæ¿€å…‰é›·è¾¾æ‰«ææ•°æ®
- **ä¼ æ„Ÿå™¨æ•°æ®**: æ˜¾ç¤ºIMUå’Œç”µæœºæ•°æ®
- **äº¤äº’æ§åˆ¶**: æ”¯æŒé¼ æ ‡ç¼©æ”¾å’Œé”®ç›˜æ§åˆ¶

## å®‰è£…ä¾èµ–

```bash
pip install pyserial matplotlib numpy
```

## ä½¿ç”¨æ–¹æ³•

### 1. åŸºæœ¬ä½¿ç”¨

```python
from hardware_bluetooth_module import HardwareBluetoothInterface, HardwareBluetoothVisualizer

# åˆ›å»ºè“ç‰™æ¥å£
bt_interface = HardwareBluetoothInterface(port="COM3", baudrate=115200)

# è¿æ¥è“ç‰™
if bt_interface.connect():
    print("è“ç‰™è¿æ¥æˆåŠŸ")
    
    # å‘é€æ§åˆ¶å‘½ä»¤
    bt_interface.send_motor_command(1)  # å‰è¿›
    
    # è·å–æ•°æ®
    lidar_data = bt_interface.get_latest_lidar_data()
    imu_data = bt_interface.get_latest_imu_data()
    
    # æ–­å¼€è¿æ¥
    bt_interface.disconnect()
```

### 2. å¯è§†åŒ–æ¨¡å¼

```python
# å¯åŠ¨å®Œæ•´å¯è§†åŒ–ç•Œé¢
python hardware_bluetooth_module.py
```

### 3. é”®ç›˜æ§åˆ¶

åœ¨å¯è§†åŒ–ç•Œé¢ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹é”®ç›˜æ§åˆ¶ï¼š

- **0**: åœæ­¢
- **1**: å‰è¿›
- **2**: åé€€  
- **3**: å·¦è½¬
- **4**: å³è½¬
- **5**: æ‰å¤´

## æ•°æ®æ ¼å¼

### æ¿€å…‰é›·è¾¾æ•°æ®
```
A:123.45,D:0.678,Q:10
```
- A: è§’åº¦(åº¦)
- D: è·ç¦»(ç±³)
- Q: è´¨é‡

### IMUæ•°æ®
```
roll:12.34, pitch:-5.67, yaw:90.0
```
- roll: æ¨ªæ»šè§’(åº¦)
- pitch: ä¿¯ä»°è§’(åº¦)
- yaw: åèˆªè§’(åº¦)

### ç”µæœºæ•°æ®
```
MotorA:123.4,RPMB:567.8
```
- MotorA: Aç”µæœºè½¬é€Ÿ(RPM)
- RPMB: Bç”µæœºè½¬é€Ÿ(RPM)

## é…ç½®è¯´æ˜

### è“ç‰™é…ç½®
```json
{
  "bluetooth": {
    "port": "COM3",           // ä¸²å£ç«¯å£
    "baudrate": 115200,       // æ³¢ç‰¹ç‡
    "timeout": 0.1,           // è¶…æ—¶æ—¶é—´
    "retry_count": 3,          // é‡è¯•æ¬¡æ•°
    "auto_reconnect": true    // è‡ªåŠ¨é‡è¿
  }
}
```

### æ•°æ®è§£æé…ç½®
```json
{
  "data_parsing": {
    "lidar_pattern": "A:([-+]?\\d*\\.?\\d+),\\s*D:([-+]?\\d*\\.?\\d+)m?,\\s*Q:(\\d+)",
    "imu_pattern": "roll:([-+]?\\d*\\.?\\d+),\\s*pitch:([-+]?\\d*\\.?\\d+),\\s*yaw:([-+]?\\d*\\.?\\d+)",
    "motor_pattern": "MotorA:([-+]?\\d*\\.?\\d+),RPMB:([-+]?\\d*\\.?\\d+)",
    "buffer_size": 1000,
    "max_data_age": 10.0
  }
}
```

## æ•…éšœæ’é™¤

### 1. è¿æ¥é—®é¢˜
- **æ£€æŸ¥ä¸²å£**: ç¡®è®¤COMç«¯å£å·æ­£ç¡®
- **æ£€æŸ¥æ³¢ç‰¹ç‡**: ç¡®ä¿ä¸ç¡¬ä»¶ä¸€è‡´(115200)
- **æ£€æŸ¥æƒé™**: ç¡®ä¿æœ‰ä¸²å£è®¿é—®æƒé™
- **æ£€æŸ¥å ç”¨**: ç¡®ä¿ä¸²å£æœªè¢«å…¶ä»–ç¨‹åºå ç”¨

### 2. æ•°æ®è§£æé—®é¢˜
- **æ£€æŸ¥æ•°æ®æ ¼å¼**: ç¡®ä¿ç¡¬ä»¶å‘é€çš„æ•°æ®æ ¼å¼æ­£ç¡®
- **æ£€æŸ¥æ­£åˆ™è¡¨è¾¾å¼**: æ ¹æ®å®é™…æ•°æ®æ ¼å¼è°ƒæ•´è§£ææ¨¡å¼
- **æ£€æŸ¥ç¼–ç **: ç¡®ä¿æ•°æ®ç¼–ç ä¸ºUTF-8

### 3. å¯è§†åŒ–é—®é¢˜
- **æ£€æŸ¥matplotlib**: ç¡®ä¿matplotlibæ­£ç¡®å®‰è£…
- **æ£€æŸ¥åç«¯**: ä½¿ç”¨TkAggåç«¯
- **æ£€æŸ¥å­—ä½“**: ç¡®ä¿ä¸­æ–‡å­—ä½“æ­£ç¡®é…ç½®

## é«˜çº§ç”¨æ³•

### 1. è‡ªå®šä¹‰æ•°æ®å›è°ƒ

```python
def my_data_callback(data):
    print(f"æ”¶åˆ°æ•°æ®: {data}")

bt_interface.add_data_callback(my_data_callback)
```

### 2. æ•°æ®è¿‡æ»¤

```python
# è·å–ç‰¹å®šè´¨é‡çš„æ•°æ®
lidar_data = bt_interface.get_latest_lidar_data()
filtered_data = [point for point in lidar_data if point.quality > 10]
```

### 3. æ•°æ®ä¿å­˜

```python
import json

# ä¿å­˜æ¿€å…‰é›·è¾¾æ•°æ®
lidar_data = bt_interface.get_latest_lidar_data()
data_to_save = [
    {
        'angle': point.angle,
        'distance': point.distance,
        'quality': point.quality,
        'timestamp': point.timestamp
    }
    for point in lidar_data
]

with open('lidar_data.json', 'w') as f:
    json.dump(data_to_save, f, indent=2)
```

## ä¸HCè“ç‰™åŠ©æ‰‹çš„å¯¹æ¯”

| åŠŸèƒ½ | HCè“ç‰™åŠ©æ‰‹ | æœ¬æ¨¡å— |
|------|------------|--------|
| è“ç‰™è¿æ¥ | âœ… | âœ… |
| æ•°æ®æ¥æ”¶ | âœ… | âœ… |
| æ•°æ®è§£æ | âœ… | âœ… |
| å¯è§†åŒ– | âŒ | âœ… |
| ç”µæœºæ§åˆ¶ | âŒ | âœ… |
| æ•°æ®ä¿å­˜ | âŒ | âœ… |
| é”™è¯¯å¤„ç† | åŸºç¡€ | å®Œå–„ |
| æ‰©å±•æ€§ | æœ‰é™ | é«˜ |

## æ³¨æ„äº‹é¡¹

1. **æ•°æ®åŒæ­¥**: ç¡®ä¿ç¡¬ä»¶å’Œè½¯ä»¶çš„æ•°æ®æ ¼å¼ä¸€è‡´
2. **æ€§èƒ½ä¼˜åŒ–**: å¤§æ•°æ®é‡æ—¶æ³¨æ„å†…å­˜ä½¿ç”¨
3. **çº¿ç¨‹å®‰å…¨**: å¤šçº¿ç¨‹ç¯å¢ƒä¸‹æ³¨æ„æ•°æ®åŒæ­¥
4. **é”™è¯¯å¤„ç†**: ç½‘ç»œä¸ç¨³å®šæ—¶æ³¨æ„é‡è¿æœºåˆ¶
5. **èµ„æºæ¸…ç†**: ç¨‹åºé€€å‡ºæ—¶ç¡®ä¿èµ„æºæ­£ç¡®é‡Šæ”¾

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š
1. ç¡¬ä»¶è¿æ¥æ˜¯å¦æ­£å¸¸
2. ä¸²å£é…ç½®æ˜¯å¦æ­£ç¡®
3. æ•°æ®æ ¼å¼æ˜¯å¦åŒ¹é…
4. ä¾èµ–åº“æ˜¯å¦å®Œæ•´å®‰è£…
